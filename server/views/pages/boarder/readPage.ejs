<!DOCTYPE html>
<html>

<head>
    <title>welcome Test IOF</title>
    <% include ../../partials/stylesheet.ejs %>
    <% include ../../partials/header_javascript.ejs %>
    <% include ../../partials/weather_config.ejs %>
</head>


<body class="hold-transition skin-blue sidebar-mini">
    <div class="wrapper">
        <header class="main-header">
            <!-- Logo -->
            <a href="/" class="logo">
                <!-- mini logo for sidebar mini 50x50 pixels -->
                <span class="logo-mini"><b>I</b>OF</span>
                <!-- logo for regular state and mobile devices -->
                <span class="logo-lg"><b>C &amp; H </b>IOF</span>
            </a>
            <!-- Header Navbar: style can be found in header.less -->
            <nav class="navbar navbar-static-top">
                <!-- Sidebar toggle button-->
                 <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                        <span class="sr-only">Toggle navigation</span>
                </a>
                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">
                        <!-- Tasks: style can be found in dropdown.less -->
                    </ul>
                </div>
            </nav>
        </header>
        <!-- Left side column. contains the logo and sidebar -->
        <aside class="main-sidebar">
            <!-- sidebar: style can be found in sidebar.less -->
            <section class="sidebar">
                <!-- Sidebar user panel -->
                <div class="user-panel">
                    <div class="pull-left image">
                        <img src="/static/images/logo_iot.png" class="img-circle" alt="User Image">
                    </div>
                    <div class="pull-left info">
                        
                        <!-- <a href="#"><i class="fa fa-circle text-success"></i> Online</a> -->
                    </div>
                </div>
                <!-- nav item -->
                <% include ../../partials/nav_item %>
                <!-- end nav item -->
            </section>
            <!-- /.sidebar -->
        </aside>
        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
                <!-- Content Header (Page header) -->
                 <section class="content-header">
                    <h1>
                        Boarder <small>read</small>
                    </h1>
                    <ol class="breadcrumb">
                        <li><a href="/"><i class="fa fa-dashboard"></i> Home</a></li>
                        <li><i class="ffa fa-dshboard"><a href="/boards"></i>boarder</a></li>
                        <li class="active"><a href="#">read</a></li>
                    </ol>
                </section> 
                  <!-- Main content -->
    <section class="content">
            <div class="row">
              <div class="col-md-12">
                 <!-- general form elements -->
                 <div class="box box-primary">
                    <div class="box-header">
                        <h3 class"box-title">READ BOARD</h3>
                    </div>
                    <!-- header box end-->
                    <div class="box-body">
                    <!-- form group start -->
                    
                    <!-- 여기서부터 수정 필요 -->
                    <% for(let post of posts){ %>
                        <div class="form-group">
                            <label for="exampleInputEmail1">Title</label>
                            <input type="text" name='title' class="form-control" 
                                value="<%=post.title %>" readonly="readonly">
                        </div>
                        
                        <div class="form-group">
                            <label for="exampleInputPassword1">Content</label>
                            <textarea class="form-control"  name="content" rows="3" 
                                readonly="readonly"><%= post.content%></textarea>
                        </div>
                        <div class="form-group">
                            <label for="exampleInputEmail1" >Writer</label>
                            <input type="text" name="writer" class="form-control" 
                                value="<%=post.writer %>" readonly="readonly">
                        </div>
                        <!-- form group end -->
                    </div>
                    <!-- box body end-->
                    <div class="box-footer">
	                    <!-- checking id  function start if -->
	                        <button id="modify" type="button" class="btn btn-warning">Modify</button> 
	                        <button id="remove" type="button" class="btn btn-danger">REMOVE</button> 
                        <!-- login check function end -->
                        <button id="list" type="button" class="btn btn-primary">GO LIST </button>
                    </div>
                <!-- box-footer end -->
                 </div>
                <div class="row">
		            <div class="col-md-12">
			            <div class="box box-success">
				            <div class="box-header">
					            <h3 class="box-title">ADD NEW REPLY</h3>
				            </div>
				            <div class="box-body">
					            <label for="exampleInputEmail1">Writer</label> 
					            <input class="form-control" type="text" placeholder="USER ID"    id="newReplyWriter"> 
					            <label for="exampleInputEmail1">Reply Text</label> 
					            <input class="form-control" type="text" placeholder="REPLY TEXT" id="newReplyText">
				            </div>
				        <!-- /.box-body -->
				            <div class="box-footer">
					            <button type="button" class="btn btn-primary" id="replyAddBtn">ADD REPLY</button>
				            </div>
			            </div>
                        <!-- The time line -->
		                <ul class="timeline">
		  	            <!-- timeline time label -->
			                <li class="time-label" id="repliesDiv">
			                    <span class="bg-green">
			                        Replies List <small id='replycntSmall'> [ 000 ] </small>
			                    </span>
			                </li>
		                </ul>
		                <!--  -->
		                <ul id="rlist">
				            <% if(post.tbl_replies) { 
                                for(let reply of post.tbl_replies){ %>
					            <li class="time-label"><%=reply.dataValues.rcontent%>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						           <%=reply.dataValues.rwriter%> <a href="javascript:removeReply(<%=reply.dataValues.id%>,<%=reply.dataValues.tblBoardId%>)">X</a> 
					            </li>
                            <%}%>
                            <%}%>
		                </ul>
		            <!--  -->   
			            <div class='text-center'>
				            <ul id="pagination" class="pagination pagination-sm no-margin ">
				            </ul>
            			</div>

<%}%>

              </div>
              <!-- /.col-->
            </div>
            <!-- ./row -->
          </section>
          <!-- /.content -->
            </div>
        <% include ../../partials/footer.ejs %>
            <div class="control-sidebar-bg"></div>
        </div>
        <!-- /.content-wrapper -->
      
            <!-- /.control-sidebar -->
            <!-- Add the sidebar's background. This div must be placed
       immediately after the control sidebar -->
    </div>
    
    <% include ../../partials/footer_javascript_index.ejs %>
   
<script>
	function removeReply(seq,bno) {
		alert(seq);
		
		$.ajax({
			url  : "replyRemove" , 
			type : "post" , 
			data : { rseq : seq , bno : bno} ,
			dataType : "json" , 
			success : function(ary) {
				$("#rlist").empty(); // remove() 
				var txt = "";
				$.each(ary , function(idx, obj) {
					txt += "<li class='time-label'>"+obj.rcontent;
					txt += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
					txt += "<a href='javascript:removeReply("+obj.rseq+","+obj.bno+")'>X</a></li>";
				});
				$("#rlist").append(txt);
			}
		});
		 
	}

	$(document).ready(function() {
		$("#list").click(function() {
			location.href="list" ; 
		});
		$("#remove").click(function() {
			//location.href="removePage?bno="+${board.bno} ; 
		});
		$("#modify").click(function() {
			//location.href="modifyPage?bno="+${board.bno} ; 
		});
		
		$("#replyAddBtn").click(function() {
            
			$.ajax({
				url  : "process/create/reply" , 
				type : "post" , 
				data : {
                        rwriter : $("#newReplyWriter").val() ,
					    rcontent : $("#newReplyText").val()  , 
					    bno: <%=posts[0].dataValues.id%>
					   } ,
				dataType : "json" , 
				success : function(ary) {
                    console.log(ary);
					$("#rlist").empty(); // remove() 
					var txt = "";
					$.each(ary , function(idx, obj) {
                        var test = JSON.stringify(obj);
						txt += "<li class='time-label'>"+obj.rcontent;
						txt += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
						txt += "<a href='javascript:removeReply("+obj.rseq+","+obj.bno+")'>X</a></li>";
					});
					$("#rlist").append(txt);
				}
			});
			/////////
		});
	});

/* 
$(document).ready(function(){
	
	var formObj = $("form[role='form']");
	
	console.log(formObj);
	
	if(${boardVO.writer==sessionScope.loginUser.uname}
	  || ${sessionScope.loginUser.uname=='관리자'}){
		$(".box-footer").html(
				'<button type="submit" class="btn btn-warning">Modify</button> '
			   +'<button type="submit" class="btn btn-danger">REMOVE</button> '
			   +'<button type="submit" class="btn btn-primary">GO LIST </button>');
	}
});

$(document).on("click", ".btn-warning", function(){
	var formObj = $("form[role='form']");
	formObj.attr("action", "/board/modifyPage.do");
	formObj.attr("method", "get");		
	formObj.submit();
});

$(document).on("click", ".btn-danger", function(){
	var formObj = $("form[role='form']");
	if(confirm("게시물을 삭제하시겠습니까?")){	
		formObj.attr("action", "/board/removePage.do");
		formObj.submit();
	}
});

$(document).on("click", ".btn-primary", function(){
	var formObj = $("form[role='form']");
	formObj.attr("method", "get");
	formObj.attr("action", "/board/listPage.do");
	formObj.submit();
});
*/
</script>

  </body>
</html>
